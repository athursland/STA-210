---
title: "Final Project"
author: "Ali Thursland and Mary Helen Wood"
date: "11/20/2018"
output: html_document
---

```{r setup, warning=FALSE, echo=FALSE, message=FALSE}
#Setup
library("dplyr")
library("ggplot2")
library("broom")
library("knitr")
library("cowplot")
library("readr")
library("dslabs")
```

```{r data}
#Read file
airbnb <- read.csv("https://raw.githubusercontent.com/athursland/STA-210/master/airbnb.csv?fbclid=IwAR0ffZSvoMPWxJjX-a4gWp2UlripEqAK0NJtu2ioHgmG0uWjCm20Hse8pNw")
```

# Data Preparation

```{r manipulating-data}
#Make new variable has_reviews
airbnb <- airbnb %>% 
  mutate(has_reviews = case_when( 
    number_of_reviews == 0 ~ 0, 
    number_of_reviews > 0 ~ 1)
  )

#Make NAs = 0 for security_deposit
airbnb <- airbnb %>% 
  mutate(security_deposit = if_else(is.na(security_deposit),0,security_deposit))

#Make NAs = 0 for cleaning_fee
airbnb <- airbnb %>% 
  mutate(cleaning_fee = if_else(is.na(cleaning_fee),0,cleaning_fee))

#Make NAs = 0 for review_scores_rating
airbnb <- airbnb %>% 
  mutate(review_scores_rating = case_when(
    is.na(review_scores_rating) ~ 0, 
    !is.na(review_scores_rating) ~ review_scores_rating)
    )

#Make NAs = 0 for review_scores_accuracy
airbnb <- airbnb %>% 
  mutate(review_scores_accuracy = case_when(
    is.na(review_scores_accuracy) ~ 0, 
    !is.na(review_scores_accuracy) ~ review_scores_accuracy)
    )

#Make NAs = 0 for review_scores_cleanliness
airbnb <- airbnb %>% 
  mutate(review_scores_cleanliness = case_when( 
    is.na(review_scores_cleanliness) ~ 0, 
    !is.na(review_scores_cleanliness) ~ review_scores_cleanliness)
    )

#Make NAs = 0 for review_scores_checkin
airbnb <- airbnb %>% 
  mutate(review_scores_checkin = case_when( 
    is.na(review_scores_checkin) ~ 0, 
    !is.na(review_scores_checkin) ~ review_scores_checkin)
    )

#Make NAs = 0 for review_scores_communcation
airbnb <- airbnb %>% 
  mutate(review_scores_communication = case_when( 
    is.na(review_scores_communication) ~ 0, 
    !is.na(review_scores_communication) ~ review_scores_communication)
    )

#Make NAs = 0 for review_sores_location 
airbnb <- airbnb %>% 
  mutate(review_scores_location = case_when( 
    is.na(review_scores_location) ~ 0, 
    !is.na(review_scores_location) ~ review_scores_location)
    )

#Make NAs = 0 for review_scores_value
airbnb <- airbnb %>% 
  mutate(review_scores_value = case_when( 
    is.na(review_scores_value) ~ 0, 
    !is.na(review_scores_value) ~ review_scores_value)
    )

#Make NAs = 0 for reviews_per_month
airbnb <- airbnb %>% 
  mutate(reviews_per_month = case_when( 
    is.na(reviews_per_month) ~ 0, 
    !is.na(reviews_per_month) ~ reviews_per_month)
    )
```

```{r omit-na}
#Omit all observations with NAs 
airbnb <- airbnb[complete.cases(airbnb),]
```

# Separate training and testing

```{r separate}
#80% of the sample size
smp_size <- floor(0.80 * nrow(airbnb))

#set the seed to make your partition reproducible
set.seed(12345)
train_ind <- sample(seq_len(nrow(airbnb)), size = smp_size)

train.airbnb <- airbnb[train_ind, ]
test.airbnb <- airbnb[-train_ind, ]
```

# Description of data

Question of interest: How can we produce a model that accurately predicts the listed nightly price for an Airbnb in Asheville, NC?

  The data set we are using is a .csv file of every AirBnB listing in the city of Asheville, North Carolina as of October 17, 2018 . Each observation is an individual listing. We sourced this data from Inside AirBnB, a website that regularly scrapes data from AirBnB’s listings and provides them as public data sets separated by city.

  The original data set was very large (96 columns and 1,936 observations), so we reduced it for simplicity’s sake. We chose 26 columns that could potentially be of interest for a regression analysis, and we created one more column called has_reviews, which is an indicator variable. We noticed that some columns, like cleaning_fee and security_deposit, had a lot of NAs, so instead of omitting all of these observations we mutated NAs from these columns to be 0s. We were left with 24 incomplete cases, likely the result of web scraping errors, and so we chose to omit them. Our final number of columns was 27 and our final number of rows was 1,911. 

Variables: 
* host_response_rate
* host_is_superhost
* total listings
* zip code
* property_type
* room_type
* accomodates
* bathrooms
* beds
* bed_type
* price
* security deposit
* cleaning fee
* guests included 
* extra people cost
* minimum nights
* maximum nights
* availability_30
* number_of_reviews
* review_scores_rating
* review_scores_accuracy
* review_scores_cleanliness
* review_scores_checkin
* review_scores_communication
* review_scores_location
* review_scores_value
* reviews_per_month
* cancellation_policy

# Background

Airbnb, inc. is a privately held global company headquartered in San Francisco that operates as a broker for lodging arrangements. Made famous by celebrities like Kim Kardashian, the company is revolutionizing the way people vacation. Rather than booking a hotel, users can go on the AirBnB website or mobile app and quickly rent private rooms, guest suites or even entire homes to themselves. The company has often faced controversy surrounding housing affordability, pricing transparency, privacy and hotel industry competition. Despite these concerns, it blew by its own internal forecasts and brought in 2.6 billion dollars in revenue and 93 million in profit by the end of 2017. For a company that exclusively makes money by taking a small commission (3%) of the price of every listing, that’s pretty impressive.
  
  We were interested in this data because it’s something that so many people, especially our peers here at Duke, would find relevant. There are over 4 million AirBnB listings worldwide and 150 million global users. Both Mary Helen and I have stayed in an AirBnB in the last month. With the option to rent entire homes, AirBnBs offer more luxury, space and solitude than other lodging options. Hosts set prices for listings at their own discretion, and so there isn’t any specific algorithm or model by which it’s calculated. By using this data to create a model that can accurately predict prices for listings, we might be able to help people figure out what the typical price range is for the type of listing they want – and therefore, whether or not a specific listing is a good deal. Specifically, we’ll be looking at AirBnB listings in the Asheville Metro Area, North Carolina. Asheville is a popular weekend getaway in North Carolina. Given its relative proximity to Duke, many students visit at least once during their time here – often staying in AirBnBs when they do. This makes our data more relevant to our peers, and also helps us by narrowing down the total number of observations into a size that’s more manageable.

# Exploratory Data Analysis

```{r pairs-plots}
#pairs plots for all of the explanatory variables
pairs(price ~ host_response_rate + host_is_superhost + host_listings_count, data=train.airbnb)
pairs(price ~ zipcode + room_type + bathrooms, data=train.airbnb)
pairs(price ~ accommodates + beds + bed_type, data=train.airbnb)
pairs(price ~ security_deposit + cleaning_fee + guests_included, data = train.airbnb)
pairs(price ~ extra_people + minimum_nights + availability_30, data = train.airbnb)
pairs(price ~ number_of_reviews + review_scores_rating + review_scores_accuracy, data = train.airbnb)
pairs(price ~ review_scores_cleanliness + review_scores_checkin + review_scores_communication, data = train.airbnb)
pairs(price ~ review_scores_location + review_scores_value + reviews_per_month, data = train.airbnb)
pairs(price ~ cancellation_policy, data = train.airbnb)
```

```{r mutate}
train.airbnb <- train.airbnb %>% mutate(log.bathrooms = log(bathrooms),
                            log.cleaningfee = log(cleaning_fee),
                            log.securitydeposit = log(security_deposit),
                            log.guestsincluded = log(guests_included),
                            log.nreviews = log(number_of_reviews))
```

```{r}
pairs(price ~ log.bathrooms + log.cleaningfee, data = train.airbnb)
pairs(price ~ log.securitydeposit + log.guestsincluded + log.nreviews, data = train.airbnb)
```


